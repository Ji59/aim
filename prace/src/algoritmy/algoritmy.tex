\chapter{Algoritmy}\label{ch:algoritmy}

%Popis společné části algoritmů (vstup, výstup).
%
%Stručný text o parametrech algoritmů.

Algoritmy tvoří plánující logiku křižovatky.
Jak bylo popsáno v~sekci \hyperref[sec:simulace]{simulace}, algoritmus hledá trasy pro~všechny agenty.
Každému úspěšně naplánovanému agentovi se přidělí nalezená trasa.

Všechny algoritmy podporují stejnou funkci \ref{alg:plan_agents},
kterou volá simulátor pro~nalezení tras agentů v~určitém kroku.
Vstup této funkce je krok simulace a množina agentů přijíždějících v~daném kroku.
Aby simulátor poznal, kterým agentům úspěšně přiřadil algoritmus trasu,
vrací funkce množinu úspěšně naplánovaných agentů.
Níže je zobrazen pseudokód výchozího chování funkce
\textrm{plan\_agents}\labeltext{\textrm{plan\_agents}}{alg:plan_agents}.

% @formatter:off
\begin{code}[xrightmargin=6em]
// vstup plánovaný krok step, množina agentů agents
// výstup množina naplánovaných agentů planned_agents
plan_agents(step, agents)
agents_mapped <- empty_set
for agent in agents
agents_mapped.add([agent, agent.entry, agent.exits])
return plan_agents(agents_mapped, step)
\end{code}
% @formatter:on

Všechny algoritmy podporují další pomocné funkce pro~zjednodušení a propojení algoritmů.
První pomocná funkce se~nazývá \ref{alg:plan_agent},
která má za~úkol naplánovat pouze jednoho agenta.
Tuto funkci využiji při~použití \ref{str:rs} strategie
(této strategii odpovídá výchozí implementace funkce \ref{alg:plan_agents}).
Funkce \textrm{plan\_agent}\labeltext{\textrm{plan\_agent}}{alg:plan_agent} dostává na~vstup krok, ve~kterém má~být agent naplánován.
Další parametry jsou agent, který má~být naplánován, vrchol,
ze~kterého agent vyjíždí a množina vrcholů, na~kterých může agent skončit.
Implementace funkce už~není jednotná a závisí na~každém algoritmu.
Funkce vrací agenta pokud byl úspěšně naplánován, jinak $NULL$.

% @formatter:off
\begin{code}[xrightmargin=14em]
// vstup plánovaný krok step, agent agent,
// vjezd entry a výjezdy exits
// výstup agent nebo NULL
plan_agent(step, agent, entry, exits)
// implementace algoritmu
if plánování úspěšné
agent.path <- planned_path
return agent
else
return NULL
\end{code}
% @formatter:on

Další pomocná funkce je rozšíření funkce \ref{alg:plan_agents}, která má na~vstupu krok plánování.
Další vstup je množina trojic, kde~první prvek trojice je agent, který má~být naplánován.
Další prvek je vrchol ze~kterého agent vyjíždí a
poslední prvek je množina cílových vrcholů, což jsou možné vrcholy, na~kterých má agent skončit.
Funkce opět vrací množinu naplánovaných agentů.
Pseudokód výchozího chování je následovný.
% @formatter:off
\begin{code}[xrightmargin=6em]
// vstup plánovaný krok step, množina trojic agentů,
// vjezdů a výjezdů agents_entries_exits
// výstup množina naplánovaných agentů planned_agents
plan_agents(step, agents_entries_exits)
planned_agents <- empty_set
for agent_entry_exits in agents_entries_exits
agent = agent_entry_exits[0]
entry = agent_entry_exits[1]
exists = agent_entry_exits[2]
planned_agent <- plan_agent(step, agent, entry, exists)
if planned_agent is not NULL
planned_agents.add(planned_agent)
return planned_agents
\end{code}
% @formatter:on

Implementované algoritmy mají různé nastavitelné parametry, které ovlivňují nalezené trasy, optimalitu či~dobu běhu.
Každý algoritmus má speciální parametry pro~něj vhodné.
Tyto~parametry proto budou popsány zvlášť a zároveň zvlášť testovány.

\input{algoritmy/kolize}

\input{algoritmy/safe_lanes}

\input{algoritmy/a_star}

\input{algoritmy/sat_planner}
